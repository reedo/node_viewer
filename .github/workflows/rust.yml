name: Rust

on:
    push:
        branches: [ "main" ]
    pull_request:
        branches: [ "main" ]

env:
    CARGO_TERM_COLOR: always

jobs:
    build:
        name: Build
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4

            -   name: Build
                run: cargo build --verbose

            -   name: Run tests
                run: cargo test --verbose

    fmt:
        name: Rustfmt
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4

            -   uses: actions-rs/toolchain@v1
                with:
                    profile: minimal
                    toolchain: stable
                    override: true
                    components: rustfmt

            -   name: Check formatting
                run: rustfmt --all -- --check

    clippy:
        name: Clippy
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4

            -   uses: actions-rs/toolchain@v1
                with:
                    profile: minimal
                    toolchain: stable
                    override: true
                    components: clippy

            -   name: Run clippy
                run: cargo clippy --all-targets --all-features -- -D warnings

    trunk:
        name: Trunk
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v4

            -   uses: actions-rs/toolchain@v1
                with:
                    profile: minimal
                    toolchain: stable
                    target: wasm32-unknown-unknown
                    override: true

            -   name: Download and install Trunk binary
                run: wget -qO- https://github.com/thedodd/trunk/releases/latest/download/trunk-x86_64-unknown-linux-gnu.tar.gz | tar -xzf-

            -   name: Build
                run: ./trunk build
